<%= form_with model: @post, local: true do |f| %>
  <div>タイトル</div>
  <%= f.text_field :title %>
  <div class="code-block">
    <div>内容</div>
    <%= f.text_area :content, class: "inline-attachment", id: 'content', size: "100x50"  %>
  </div>
  <div class="code-block">
    <div>表示される内容</div>
    <div id="code_markdown"></div>   <%# ここにMarkdownに変換された入力内容が入る %>
  </div>
...
  <div>サムネイル画像</div>
   <%= f.file_field :thumbnail_image %><br>
  <div>画像</div>
   <%= f.file_field :images, multiple: true  %><br>
  <%= f.submit %>
<% end %>
<%= link_to 'Show', @post %> |
<%= link_to 'Back', posts_path %>

<script>
function markdownCode() {
  const codeInput = document.getElementById('content');  // idが'user_answer_code'のもの(textarea)
  const codeMarkdown = document.getElementById('code_markdown');  // idが'code_markdown'のもの(空のdiv)
  if (codeInput == null || codeMarkdown == null) {
    return;  // 該当ページでない場合はアーリーリターン
  }

  codeInput.addEventListener('input', () => {
    const HTML = `${codeInput.value}`;
    codeMarkdown.innerHTML = marked(HTML);
    const pre_code_nodes = document.querySelectorAll("pre code");  // ここがポイント
    for(let i = 0; i < pre_code_nodes.length; ++i){                // ここがポイント
      hljs.highlightBlock(pre_code_nodes[i]);                      // ここがポイント
    }
  });
};
$(document).on('turbolinks:load', function() {　
  alert (aaaa);
  const codeInput = document.getElementById('content');  // idが'content'のもの(textarea)
  const codeMarkdown = document.getElementById('code_markdown');
  const HTML = `${codeInput.value}`;
  codeMarkdown.innerHTML = marked(HTML);
  const pre_code_nodes = document.querySelectorAll("pre code");  // ここがポイント
  for(let i = 0; i < pre_code_nodes.length; ++i){                // ここがポイント
    hljs.highlightBlock(pre_code_nodes[i]);                      // ここがポイント
  }
  markdownCode();
});
window.addEventListener("load", markdownCode);
</script>